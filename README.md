# Telegram бот для Claude 3.7 Sonnet

Этот бот позволяет общаться с Claude 3.7 Sonnet через Telegram, отправляя текстовые сообщения, изображения и файлы.

## Особенности

- Общение с Claude 3.7 Sonnet
- Система кредитов для пользователей
- Анализ изображений
- Улучшенная обработка файлов (PDF, DOCX, TXT)
- Сохранение истории диалога (последние 10 сообщений)
- Разбивка больших сообщений на части для удобного чтения
- Административные функции (управление кредитами пользователей)
- Безлимитный режим для избранных пользователей
- Уведомления пользователей о действиях администратора
- Многопользовательская работа (обработка запросов от нескольких пользователей одновременно)

## Установка

1. Клонируйте репозиторий:
```
git clone https://github.com/yourusername/telegram-claude-bot.git
cd telegram-claude-bot
```

2. Установите зависимости:
```
pip install -r requirements.txt
```

3. Для Windows требуется установка дополнительных библиотек:
```
pip install python-magic-bin filetype
```

4. Запустите бота:
```
python main.py
```

## Команды бота

### Пользовательские команды:
- `/start` - Начать общение с ботом
- `/help` - Показать справку
- `/balance` - Проверить баланс кредитов
- `/reset` - Очистить историю диалога

### Административные команды:
- `/list_users` - Просмотр списка пользователей
- `/add_credits <user_id> <количество>` - Добавить кредиты пользователю
- `/remove_credits <user_id> <количество>` - Снять кредиты у пользователя
- `/set_unlimited <user_id>` - Установить безлимитный доступ пользователю
- `/unset_unlimited <user_id> <начальное_количество>` - Отменить безлимитный доступ

## Функции бота

### Разбивка длинных сообщений
Бот автоматически определяет запросы на большие тексты (рефераты, эссе, статьи) и разбивает ответы на удобные для чтения части.

### Обработка файлов
- Поддерживаемые форматы: PDF, DOCX, TXT
- Максимальный размер файла: 20 МБ
- Возможность добавления комментария к файлу в подписи
- Улучшенное определение типа файла (через несколько методов)
- Подробная обработка ошибок для работы с файлами
- Поддержка файлов без расширения (определение типа по содержимому)

### Система кредитов
- Новые пользователи получают 10 кредитов при регистрации
- Администратор может выдавать дополнительные кредиты или предоставлять безлимитный доступ

### Уведомления
Пользователи получают уведомления когда администратор:
- Добавляет кредиты
- Снимает кредиты
- Предоставляет или отменяет безлимитный доступ

## Известные ограничения
- **Автоматическое обновление кредитов** временно отключено из-за несовместимости с текущей версией библиотеки
- Для обновления кредитов пользователей администратор должен использовать команду `/add_credits`

## Решение проблем

### Windows
При возникновении ошибок с обработкой файлов в Windows:
- Убедитесь, что установлены библиотеки `python-magic-bin` и `filetype`
- Если проблемы с определением типа файла остаются, используйте файлы с корректным расширением (.pdf, .docx, .txt)

## Лицензия

MIT 